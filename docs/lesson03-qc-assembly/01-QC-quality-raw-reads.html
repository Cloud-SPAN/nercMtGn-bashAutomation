<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Automating Metagenomics Analyses with Bash Scripts - Assessing Read Quality, Trimming and Filtering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../docs/lesson03-qc-assembly/02-assembly.html" rel="next">
<link href="../../docs/lesson03-qc-assembly/00-introduction-meta.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/cloud-span-icon.png" alt="Cloud-SPAN logo." class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lessons" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lessons</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lessons">    
        <li>
    <a class="dropdown-item" href="../../index.html">
 <span class="dropdown-text">Course Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/lesson01-files-and-directories/index.html">
 <span class="dropdown-text">Files and Directories</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/lesson02-using-the-command-line/index.html">
 <span class="dropdown-text">Using the Command Line</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/lesson03-qc-assembly/index.html">
 <span class="dropdown-text">QC &amp; Assembly</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/lesson04-polishing/index.html">
 <span class="dropdown-text">Polishing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/lesson05-binning-functional-annotation/index.html">
 <span class="dropdown-text">Binning and Functional Annotation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/lesson06-taxonomic-annotations/index.html">
 <span class="dropdown-text">Taxonomic Annotations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/lesson07-automation-bash-scripts/index.html">
 <span class="dropdown-text">Automating Analyses with Bash Scripts</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../docs/miscellanea/setup.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extras" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Extras</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extras">    
        <li>
    <a class="dropdown-item" href="../../docs/miscellanea/reference.qmd">
 <span class="dropdown-text">Reference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/miscellanea/about.html">
 <span class="dropdown-text">About</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/miscellanea/data.qmd">
 <span class="dropdown-text">Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/miscellanea/faq.qmd">
 <span class="dropdown-text">Frequently Asked Questions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/miscellanea/instructornotes.qmd">
 <span class="dropdown-text">Instructor Notes</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../docs/miscellanea/license.html"> 
<span class="menu-text">License</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/miscellanea/codeofconduct.html"> 
<span class="menu-text">Code of Conduct</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/lesson03-qc-assembly/index.html">QC &amp; Assembly</a></li><li class="breadcrumb-item"><a href="../../docs/lesson03-qc-assembly/01-QC-quality-raw-reads.html">Assessing Read Quality, Trimming and Filtering</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson01-files-and-directories/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Files and Directories</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-files-and-directories/01-understanding-file-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding your file system</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-files-and-directories/02-logging-onto-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logging onto the Cloud</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-files-and-directories/03-shell-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducing the Shell</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson02-using-the-command-line/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using the Command Line</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-using-the-command-line/01-navigating-file-directories.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Navigating Files and Directories</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-using-the-command-line/02-working-with-file.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Files and Directories</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-using-the-command-line/03-redirection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Redirection</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson03-qc-assembly/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QC &amp; Assembly</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson03-qc-assembly/00-introduction-meta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Metagenomics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson03-qc-assembly/01-QC-quality-raw-reads.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assessing Read Quality, Trimming and Filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson03-qc-assembly/02-assembly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metagenome Assembly</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson04-polishing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Polishing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson04-polishing/01-polishing-assembly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Polishing an assembly</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson04-polishing/02-QC-polished-assembly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QC polished assembly</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson05-binning-functional-annotation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Binning &amp; Functional Annotation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson05-binning-functional-annotation/01-binning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metagenome Binning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson05-binning-functional-annotation/02-binning_quality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QC of metagenome bins</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson05-binning-functional-annotation/03-Functional-annotation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Functional annotation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson06-taxonomic-annotations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Taxonomic Annotations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson06-taxonomic-annotations/01-taxonomic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Taxonomic Assignment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson06-taxonomic-annotations/02-Diversity-tackled-with-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diversity Tackled With R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson06-taxonomic-annotations/03-hands_on-diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Taxonomic Analysis with R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson07-automation-bash-scripts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automating Analyses with Bash Scripts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson07-automation-bash-scripts/01-scripting-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Bash Scripting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson07-automation-bash-scripts/02-base-automation-script.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base Automation Script</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link active" data-scroll-target="#getting-started">Getting started</a></li>
  <li><a href="#reminder-our-file-structure" id="toc-reminder-our-file-structure" class="nav-link" data-scroll-target="#reminder-our-file-structure">Reminder: our file structure</a></li>
  <li><a href="#quality-control" id="toc-quality-control" class="nav-link" data-scroll-target="#quality-control">Quality control</a></li>
  <li><a href="#illumina-quality-control-using-fastqc" id="toc-illumina-quality-control-using-fastqc" class="nav-link" data-scroll-target="#illumina-quality-control-using-fastqc">Illumina Quality control using FastQC</a>
  <ul class="collapse">
  <li><a href="#about-fastqc" id="toc-about-fastqc" class="nav-link" data-scroll-target="#about-fastqc">About FastQC</a></li>
  <li><a href="#getting-started-with-fastqc" id="toc-getting-started-with-fastqc" class="nav-link" data-scroll-target="#getting-started-with-fastqc">Getting started with FastQC</a></li>
  <li><a href="#looking-at-fastqc-outputs" id="toc-looking-at-fastqc-outputs" class="nav-link" data-scroll-target="#looking-at-fastqc-outputs">Looking at FastQC outputs</a></li>
  </ul></li>
  <li><a href="#nanopore-quality-control" id="toc-nanopore-quality-control" class="nav-link" data-scroll-target="#nanopore-quality-control">Nanopore quality control</a></li>
  <li><a href="#filtering-nanopore-sequences-by-quality-score" id="toc-filtering-nanopore-sequences-by-quality-score" class="nav-link" data-scroll-target="#filtering-nanopore-sequences-by-quality-score">Filtering Nanopore sequences by quality score</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Cloud-SPAN/nercMtGn-bashAutomation/edit/main/docs/lesson03-qc-assembly/01-QC-quality-raw-reads.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Cloud-SPAN/nercMtGn-bashAutomation/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/lesson03-qc-assembly/index.html">QC &amp; Assembly</a></li><li class="breadcrumb-item"><a href="../../docs/lesson03-qc-assembly/01-QC-quality-raw-reads.html">Assessing Read Quality, Trimming and Filtering</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Assessing Read Quality, Trimming and Filtering</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<p>The first thing we need to do is log in to our cloud instance.</p>
<ol type="1">
<li><p><strong>Open the <em>cloudspan</em> folder you created for the course</strong></p>
<p>Open your file manager and navigate to the <code>cloudspan</code> folder (hint: we recommended you make the folder in your <em>Desktop</em> directory - but you might have made it somewhere else). If you cannot find the folder, you can remind yourself where it is stored by looking at the absolute path you wrote down in the previous episode.</p>
<p>The folder should contain the login key file we downloaded in the previous episode and nothing else.</p></li>
<li><p><strong>Right-click and open your machine’s command line interface</strong></p>
<p>Now we can open the command line.</p>
<p>For Windows users:</p>
<ul>
<li>Right click anywhere inside the blank space of the file manager, then select <strong>Git Bash Here</strong>.</li>
</ul>
<p>For Mac users:</p>
<p>You have two options.</p>
<p>EITHER</p>
<ul>
<li>Open <strong>Terminal</strong> in one window and type <code>cd</code> followed by a space. Do not press enter! Now open <strong>Finder</strong> in another window. Drag and drop the <code>cloudspan</code> folder from the Finder to the Terminal. You should see the file path leading to your <code>cloudspan</code> folder appear. Now press enter to navigate to the folder.</li>
</ul>
<p>OR</p>
<ul>
<li>Open <strong>Terminal</strong> and type <code>cd</code> followed by the absolute path that leads to your <code>cloudspan</code> folder. Press enter.</li>
</ul></li>
<li><p><strong>Login into your instance</strong></p>
<pre><code>$ ssh -i login-key-instanceNNN.pem&nbsp; csuser@instanceNNN.cloud-span.aws.york.ac.uk</code></pre>
<p>{: .bash}</p></li>
</ol>
<p><em>Be sure to replace NNN with your own number, twice.</em></p>
</section>
<section id="reminder-our-file-structure" class="level2">
<h2 class="anchored" data-anchor-id="reminder-our-file-structure">Reminder: our file structure</h2>
<p>Before we start, here’s a reminder of what our file structure looks like as a hierarchy tree: <img src="../fig/blank_instance_file_tree_with_hidden.png" class="img-fluid" alt="A file hierarchy tree">{:width=“400px”} Keep this in mind as we continue to navigate the file system, and don’t hesitate to refer back to it if needed.</p>
</section>
<section id="quality-control" class="level2">
<h2 class="anchored" data-anchor-id="quality-control">Quality control</h2>
<p><img align="left" width="325" height="226" src="{{ page.root }}/fig/short_analysis_flowchart_crop1.png" alt="Analysis flow diagram that shows the steps: Sequence reads and Quality control."></p>
<p>Before assembling our metagenome from the the short-read Illumina sequences and the long-read Nanopore sequences, we need to apply quality control to both. The two types of sequence data require different QC methods. We will use:</p>
<ul>
<li><a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> to examine the quality of the short-read Illumina data</li>
<li><a href="https://github.com/wdecoster/NanoPlot">NanoPlot</a> to examine the quality of the long-read Nanopore data and <a href="https://bioinf.shenwei.me/seqkit/">Seqkit</a> to trim and filter them.</li>
</ul>
<p><br clear="left"></p>
</section>
<section id="illumina-quality-control-using-fastqc" class="level2">
<h2 class="anchored" data-anchor-id="illumina-quality-control-using-fastqc">Illumina Quality control using FastQC</h2>
<p>In previous lessons we had a look at our data files and found they were in FASTQ format, a common format for sequencing data. We used <code>grep</code> to look for ‘bad reads’ containing more than three consecutive Ns and put these reads into their own text file.</p>
<p>This could be rather time consuming and is very nuanced. Luckily, there’s a better way! Rather than assessing every read in the raw data by hand we can use <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> to visualise the quality of the whole sequencing file.</p>
<section id="about-fastqc" class="level3">
<h3 class="anchored" data-anchor-id="about-fastqc">About FastQC</h3>
<p>Rather than looking at quality scores for each individual read, FastQC looks at quality collectively across all reads within a sample. The image below shows one FastQC-generated plot that indicates a very high quality sample:</p>
<p><img align="center" width="800" height="600" src="{{ page.root }}/fig/good_quality1.8.png" alt="Example of high quality sample - all bars are in green section"></p>
<p>The x-axis displays the base position (bp) in the read, and the y-axis shows quality scores. In this example, the sample contains reads that are 40 bp long.</p>
<p>Each position has a box-and-whisker plot showing the distribution of quality scores for all reads at that position. - The horizontal red line indicates the median quality score. - The yellow box shows the 1st to 3rd quartile range (this means that 50% of reads have a quality score that falls within the range of the yellow box at that position). - The whiskers show the absolute range, which covers the lowest (0th quartile) to highest (4th quartile) values. - The plot background is also color-coded to identify good (green), acceptable (yellow), and bad (red) quality scores.</p>
<p>Now let’s take a look at a quality plot on the other end of the spectrum.</p>
<p><img align="center" width="800" height="600" src="{{ page.root }}/fig/bad_quality1.8.png" alt="Example of low quality sample - all bars are in green section"></p>
<p>Here, we see positions within the read in which the boxes span a much wider range. Also, quality scores drop quite low into the “bad” range, particularly on the tail end of the reads. The FastQC tool produces several other diagnostic plots to assess sample quality, in addition to the one plotted above.</p>
</section>
<section id="getting-started-with-fastqc" class="level3">
<h3 class="anchored">Getting started with FastQC</h3>
<p>First, we are going to organise our analysis by creating a directory to contain the output of all of the analysis we generate in this course.</p>
<p>The <code>mkdir</code> command can be used to make a new directory. Using the <code>-p</code> flag for <code>mkdir</code> allows it to create a new directory, even if one of the parent directories doesn’t already exist. It also suppresses errors if the directory already exists, without overwriting that directory.</p>
<p>Return to your home directory (<code>/home/csuser</code>) ~~~ cd ~~~ {: .bash}</p>
<p>Create the directories <code>analysis/qc/illumina_qc</code> inside <code>cs_course</code> ~~~ mkdir -p cs_course/analysis/qc/illumina_qc ~~~ {: .bash}</p>
<p>You might want to use <code>ls</code> to check those nested directories have been made.</p>
<p>Now we have created the directories we are ready to start the quality control of the Illumina data.</p>
<p>FastQC has been installed on your instance and we can run it with the <code>-h</code> flag to display the help documentation and remind ourselves how to use it and all the parameters available:</p>
<pre><code>$ fastqc -h</code></pre>
<p>{: .bash}</p>
<blockquote class="blockquote">
<h2 id="fastqc-seq-help-documentation" class="anchored" data-anchor-id="getting-started-with-fastqc">FastQC seq help documentation</h2>
<pre><code>
            FastQC - A high throughput sequence QC analysis tool

SYNOPSIS

      fastqc seqfile1 seqfile2 .. seqfileN

    fastqc [-o output dir] [--(no)extract] [-f fastq|bam|sam]
           [-c contaminant file] seqfile1 .. seqfileN

DESCRIPTION

    FastQC reads a set of sequence files and produces from each one a quality
    control report consisting of a number of different modules, each one of
    which will help to identify a different potential type of problem in your
    data.
    
    If no files to process are specified on the command line then the program
    will start as an interactive graphical application.  If files are provided
    on the command line then the program will run with no user interaction
    required.  In this mode it is suitable for inclusion into a standardised
    analysis pipeline.
    
    The options for the program as as follows:
    
    -h --help       Print this help file and exit
    
    -v --version    Print the version of the program and exit
    
    -o --outdir     Create all output files in the specified output directory.
                    Please note that this directory must exist as the program
                    will not create it.  If this option is not set then the
                    output file for each sequence file is created in the same
                    directory as the sequence file which was processed.
                    
    --casava        Files come from raw casava output. Files in the same sample
                    group (differing only by the group number) will be analysed
                    as a set rather than individually. Sequences with the filter
                    flag set in the header will be excluded from the analysis.
                    Files must have the same names given to them by casava
                    (including being gzipped and ending with .gz) otherwise they
                    won't be grouped together correctly.
                    
    --nano          Files come from nanopore sequences and are in fast5 format. In
                    this mode you can pass in directories to process and the program
                    will take in all fast5 files within those directories and produce
                    a single output file from the sequences found in all files.                    
                    
    --nofilter      If running with --casava then don't remove read flagged by
                    casava as poor quality when performing the QC analysis.
                   
    --extract       If set then the zipped output file will be uncompressed in
                    the same directory after it has been created.  By default
                    this option will be set if fastqc is run in non-interactive
                    mode.
                    
    -j --java       Provides the full path to the java binary you want to use to
                    launch fastqc. If not supplied then java is assumed to be in
                    your path.
                   
    --noextract     Do not uncompress the output file after creating it.  You
                    should set this option if you do not wish to uncompress
                    the output when running in non-interactive mode.
                    
    --nogroup       Disable grouping of bases for reads &gt;50bp. All reports will
                    show data for every base in the read.  WARNING: Using this
                    option will cause fastqc to crash and burn if you use it on
                    really long reads, and your plots may end up a ridiculous size.
                    You have been warned!
                    
    --min_length    Sets an artificial lower limit on the length of the sequence
                    to be shown in the report.  As long as you set this to a value
                    greater or equal to your longest read length then this will be
                    the sequence length used to create your read groups.  This can
                    be useful for making directly comaparable statistics from
                    datasets with somewhat variable read lengths.
                    
    -f --format     Bypasses the normal sequence file format detection and
                    forces the program to use the specified format.  Valid
                    formats are bam,sam,bam_mapped,sam_mapped and fastq
                    
    -t --threads    Specifies the number of files which can be processed
                    simultaneously.  Each thread will be allocated 250MB of
                    memory so you shouldn't run more threads than your
                    available memory will cope with, and not more than
                    6 threads on a 32 bit machine
                  
    -c              Specifies a non-default file which contains the list of
    --contaminants  contaminants to screen overrepresented sequences against.
                    The file must contain sets of named contaminants in the
                    form name[tab]sequence.  Lines prefixed with a hash will
                    be ignored.

    -a              Specifies a non-default file which contains the list of
    --adapters      adapter sequences which will be explicity searched against
                    the library. The file must contain sets of named adapters
                    in the form name[tab]sequence.  Lines prefixed with a hash
                    will be ignored.
                    
    -l              Specifies a non-default file which contains a set of criteria
    --limits        which will be used to determine the warn/error limits for the
                    various modules.  This file can also be used to selectively
                    remove some modules from the output all together.  The format
                    needs to mirror the default limits.txt file found in the
                    Configuration folder.
                    
   -k --kmers       Specifies the length of Kmer to look for in the Kmer content
                    module. Specified Kmer length must be between 2 and 10. Default
                    length is 7 if not specified.
                    
   -q --quiet       Supress all progress messages on stdout and only report errors.
   
   -d --dir         Selects a directory to be used for temporary files written when
                    generating report images. Defaults to system temp directory if
                    not specified.
                    
BUGS

    Any bugs in fastqc should be reported either to simon.andrews@babraham.ac.uk
    or in www.bioinformatics.babraham.ac.uk/bugzilla/</code></pre>
<p>{: .output} {: .solution}</p>
</blockquote>
<p>This documentation tells us that to run FastQC we use the format <code>fastqc seqfile1 seqfile2 .. seqfileN</code>. Running the command will produce some files. By default, these are placed in the working directory from where you ran the command. We will use the <code>-o</code> option to specify a different directory for the output instead.</p>
<p>FastQC can accept multiple file names as input so we can use the *.fastqc wildcard to run FastQC on both of the FASTQ files in our <code>illumina_fastq</code> directory.</p>
<p>First, navigate to your <code>illumina_fastq/</code> directory. ~~~ cd ~/cs_course/data/illumina_fastq ~~~ {: .bash}</p>
<p>Now you can enter the command, using <code>-o</code> to tell FastQC to put its output files into our newly-made <code>illumina_qc</code> directory.</p>
<pre><code> fastqc *.fastq -o ~/cs_course/analysis/qc/illumina_qc/</code></pre>
<p>{: .bash}</p>
<p>Press enter and you will see an automatically updating output message telling you the progress of the analysis. It should start like this:</p>
<pre><code>Started analysis of ERR4998593_1.fastq
Approx 5% complete for ERR4998593_1.fastq
Approx 10% complete for ERR4998593_1.fastq
Approx 15% complete for ERR4998593_1.fastq
Approx 20% complete for ERR4998593_1.fastq
Approx 25% complete for ERR4998593_1.fastq
Approx 30% complete for ERR4998593_1.fastq</code></pre>
<p>{: .output}</p>
<p>In total, it should take around ten minutes for FastQC to run on our fastq files (however, this will depend on the size and number of files you give it). When the analysis completes, your prompt will return. So your screen will look something like this:</p>
<pre><code>Approx 75% complete for ERR4998593_2.fastq
Approx 80% complete for ERR4998593_2.fastq
Approx 85% complete for ERR4998593_2.fastq
Approx 90% complete for ERR4998593_2.fastq
Approx 95% complete for ERR4998593_2.fastq
Analysis complete for ERR4998593_2.fastq
$</code></pre>
<p>{: .output}</p>
</section>
<section id="looking-at-fastqc-outputs" class="level3">
<h3 class="anchored">Looking at FastQC outputs</h3>
<p>The FastQC program has created four new files (two for each .fastq file) within our <code>analysis/qc/illumina_qc/</code> directory. We can see them by listing the contents of the <code>illumina_qc</code> folder</p>
<pre><code> ls ~/cs_course/analysis/qc/illumina_qc/</code></pre>
<p>{: .bash}</p>
<pre><code>ERR4998593_1_fastqc.html  ERR4998593_1_fastqc.zip  ERR4998593_2_fastqc.html  ERR4998593_2_fastqc.zip   </code></pre>
<p>{: .output}</p>
<p>For each input FASTQ file, FastQC has created a <code>.zip</code> file and a <code>.html</code> file. The <code>.zip</code> file extension indicates that this is actually a compressed set of multiple output files. A summary report for our data is in the the <code>.html</code> file.</p>
<p>If we were working on our local computers, we’d be able to look at each of these HTML files by opening them in a web browser.</p>
<p>However, these files are currently sitting on our remote AWS instance, where our local computer can’t see them. And, since we are only logging into the AWS instance via the command line, it doesn’t have any web browser setup to display these files either.</p>
<p>So the easiest way to look at these webpage summary reports will be to transfer them to our local computers (i.e.&nbsp;your laptop).</p>
<p>To do this we will use the <code>scp</code> command. <code>scp</code> stands for ‘secure copy protocol’, and is a widely used UNIX tool for moving files between computers. You must <strong>run</strong> <code>scp</code> in your <strong>local terminal</strong> in your laptop.</p>
<p>The scp command takes this form: ~~~ scp <file i="" want="" to="" copy=""> <where i="" want="" the="" copy="" to="" be="" placed=""> ~~~ {: .bash}</where></file></p>
<p>You need to start a second terminal window that is <strong><em>not</em></strong> logged into the cloud instance and ensure you are in your <code>cloudspan</code> directory. This is important because it contains your pem file which will allow the <code>scp</code> command access to your AWS instance to copy the file.</p>
<blockquote class="blockquote">
<h2 id="starting-a-new-terminal" class="anchored" data-anchor-id="looking-at-fastqc-outputs">Starting a new terminal</h2>
<ol type="1">
<li><p>Open your file manager and navigate to the <code>cloudspan</code> folder which should contain the login key file</p></li>
<li><p>Open your machine’s command line interface: Windows users: Right click anywhere inside the blank space of the file manager, then select <strong>Git Bash Here</strong>. Mac users: Open <strong>Terminal</strong> and type <code>cd</code> followed by the absolute path that leads to your <code>cloudspan</code> folder. Press enter.<br>
</p></li>
<li><p>Check that you are in the right folder using <code>pwd</code></p></li>
</ol>
<p>{: .callout}</p>
</blockquote>
<p>Now use <code>scp</code> to download the file. We need to add in our PEM file, like when we log in, and we’ll also use the symbol <code>.</code> (this directory) to tell the <code>scp</code> command where to deposit the downloaded files.</p>
<p>The command will look something like: ~~~ scp -i login-key-instanceNNN.pem csuser@instanceNNN.cloud-span.aws.york.ac.uk:~/cs_course/analysis/qc/illumina_qc/*_fastqc.html . ~~~ {: .bash}</p>
<p>Remember to replace NNN with your instance number.</p>
<p>As the file is downloading you will see an output like: ~~~ scp -i login-key-instanceNNN.pem csuser@instanceNNN.cloud-span.aws.york.ac.uk:~/cs_course/analysis/qc/illumina_qc/*_fastqc.html . ERR4998593_1_fastqc.html 100% 543KB 1.8MB/s 00:00<br>
ERR4998593_2_fastqc.html 47% 539KB 1.8MB/s 00:00 ~~~ {: .output}</p>
<p>Once the files have downloaded, use File Explorer (Windows) or Finder (Mac) to find the files and open them - they should open up in your browser.</p>
<blockquote class="blockquote">
<h2 id="help" class="anchored">Help!</h2>
<p>If you had trouble downloading and viewing the files you can view them here: <a href="{{ page.root }}/files/ERR4998593_1_fastqc.html">ERR4998593_1_fastqc.html</a> and <a href="{{ page.root }}/files/ERR4998593_2_fastqc.html">ERR4998593_2_fastqc.html</a> {: .bash} {: .callout}</p>
</blockquote>
<p>First we will look at the “Per base sequence quality” graphs for <code>ERR4998593_1.fastq</code> and <code>ERR4998593_2.fastq</code>.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>ERR4998593_1.fastq</strong></th>
<th style="text-align: center;"><strong>ERR4998593_2.fastq</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="{{ page.root }}/fig/ERR4998593_1_pbsq.png" width="600"></td>
<td style="text-align: center;"><img src="{{ page.root }}/fig/ERR4998593_2_pbsq.png" width="600"></td>
</tr>
</tbody>
</table>
<p>The x-axis displays the base position in the read, and the y-axis shows quality scores. The blue line represents the mean quality across samples.</p>
<p>In both samples, the mean quality values do not drop much lower than 34 at any position. This is a high quality score meaning the sequences are high quality. That means that we do not need to do any filtering. Lucky us!</p>
<p>We should also have a look at the “Adapter Content” graph which will show us where adapter sequences occur in the reads. Adapter sequences are short sequences that are added to the sample to aid during the preparation of the DNA library. They therefore don’t tell us anything biologically important and should be removed if they are present in high numbers. They might also be removed in the case of certain applications, such as when the base sequence needs to be particularly accurate.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>ERR4998593_1.fastq</strong></th>
<th style="text-align: center;"><strong>ERR4998593_2.fastq</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="{{ page.root }}/fig/ERR4998593_1_adapter.png" width="600"></td>
<td style="text-align: center;"><img src="{{ page.root }}/fig/ERR4998593_2_adapter.png" width="600"></td>
</tr>
</tbody>
</table>
<p>This graph shows us that these sequencing file have a low percentage (~1-2%) of adapter sequences in the reads, which means we do not need to trim any adapter sequences either.</p>
<blockquote class="blockquote">
<h2 id="when-sequencing-is-poorer-quality" class="anchored">When sequencing is poor(er) Quality</h2>
<p>While the sequencing in this example is high quality this will not always be the case.</p>
<p>The programe <a href="https://github.com/marcelm/cutadapt">cutadapt</a> can be used to filter poor quality reads and trim poor quality bases. See <a href="https://cloud-span.github.io/03genomics/02-trimming/index.html">Genomics - Trimming and Filtering</a> to learn more about trimming and filtering poor quality reads.</p>
<p>{: .callout}</p>
</blockquote>
</section>
</section>
<section id="nanopore-quality-control" class="level2">
<h2 class="anchored" data-anchor-id="nanopore-quality-control">Nanopore quality control</h2>
<p>Next we will assess the quality of the Nanopore raw reads. These are found in the file located at <code>~/cs_course/data/nano_fastq/ERR5000342_sub12.fastq</code>.</p>
<p>This file contains a subset of 12% of the Nanopore reads from our site of interest (hence <code>sub12</code>). The reason we aren’t using all of the reads is because there are so many that our remote computer would be overwhelmed! We will be using the <code>sub12</code> data for the time being, but later in the course you will be given an assembly for analysis which was assembled using the full set of reads.</p>
<p>Let us again view the first complete read in one of the files from our dataset by using <code>head</code> to look at the first four lines.</p>
<p>Move to the folder containing the Nanopore data: ~~~ cd ~/cs_course/data/nano_fastq/ ~~~ {: .bash}</p>
<p>Use <code>head</code> to look at the first four line of the fastq file: ~~~ head -n 4 ERR5000342_sub12.fastq ~~~ {: .bash}</p>
<pre><code>@ERR5000342.1 1 length=407
GGTATGCTTCGTTCAGTTACGTATTGCTGTTTCGTGGCTGACCAGCAACCCGGCACCGGCGCCGAAACCGGCTCGGCGGGAATCGAGGCCCACAGCGGCACCTGCGGCGCCACCGGCAGGAACGCCACCGCGACAGCGGCCAGCGCAACGGCCACCAAAGTCGTGCCATGCGGCCCGCCGCGCACCGCTAGCAACACCGACACCGCAATCGCGAGCGCACCCCCGCCGCCACTGACGCGGCGACTGCATTCGTCAGCCGATCGCGACCGTCGCGCCTAGCCAGTTGGATAACAAACGCGAGGATCCACCAGAGTGGCGAGCACTCCGGCCAGCCCGCGCACGTTGGCCCGGTCGTGCGTGCGCAGCAAGACGATGTCGGCTGCAACGAGCAATACGTAACTTCACCA
+
*-/00*CD;&gt;AEJ4/?FF7:73../A@@?DFBA0((+&amp;%'&amp;'&amp;-)-().:B:?&gt;=FD.3HJ@A50%$$(%'$$//24%(*06A59&lt;:BGHM:FD@@8&lt;G@HHG/73*#-%'%)/')'&amp;%$$8&gt;;&gt;=:G;BDCD*'7B)-&lt;&lt;:CC6355=48BC76C=;.6B9751+,((('')89?;A@@B943BA540.+5&lt;&gt;&gt;DEA87AEEA4?CDIA792*.G&lt;B&lt;LGDD@ALL@8:;&gt;&lt;98:?=&amp;*;77864C2@A&gt;*'&lt;;;GDCAMH;811@A@IF&gt;A/+,'&amp;2285&gt;C9+(EBBC@LKDH9&lt;;;A75H?=44-/$)12145&amp;&amp;('&amp;6&lt;=@7:@&lt;9B6A&lt;;A.*)213847;@B&amp;,@C@GB?7D:B3,)18%(*-(::=?9=47A@EADHF77DHACKGA774%"%)%##$$</code></pre>
<p>{: .output}</p>
<p>This read is 408 bp, longer than the Illumina reads we looked at earlier. The length of a raw read from Nanopore sequencing varies depends on the length of the length of the DNA strand being sequenced.</p>
<p>Line 4 shows us the quality score of this read.</p>
<pre><code>*-/00*CD;&gt;AEJ4/?FF7:73../A@@?DFBA0((+&amp;%'&amp;'&amp;-)-().:B:?&gt;=FD.3HJ@A50%$$(%'$$//24%(*06A59&lt;:BGHM:FD@@8&lt;G@HHG/73*#-%'%)/')'&amp;%$$8&gt;;&gt;=:G;BDCD*'7B)-&lt;&lt;:CC6355=48BC76C=;.6B9751+,((('')89?;A@@B943BA540.+5&lt;&gt;&gt;DEA87AEEA4?CDIA792*.G&lt;B&lt;LGDD@ALL@8:;&gt;&lt;98:?=&amp;*;77864C2@A&gt;*'&lt;;;GDCAMH;811@A@IF&gt;A/+,'&amp;2285&gt;C9+(EBBC@LKDH9&lt;;;A75H?=44-/$)12145&amp;&amp;('&amp;6&lt;=@7:@&lt;9B6A&lt;;A.*)213847;@B&amp;,@C@GB?7D:B3,)18%(*-(::=?9=47A@EADHF77DHACKGA774%"%)%##$$</code></pre>
<p>{: .output}</p>
<p>Based on the PHRED quality scores (see above for a reminder) we can see that the quality scores of the bases in this read range widely. Overall they are lower than the scores for Illumina reads we looked at previously.</p>
<p>Instead of using FastQC we will use a program called <a href="https://github.com/wdecoster/NanoPlot">NanoPlot</a>, which is installed on the instance, to create some plots for the whole sequencing file. NanoPlot is specially built for Nanopore sequences.</p>
<blockquote class="blockquote">
<h2 id="other-programs-for-nanopore-qc" class="anchored">Other programs for Nanopore QC</h2>
<p>Another popular program for QC of Nanopore reads is <a href="https://github.com/a-slide/pycoQC">PycoQC</a>.</p>
<p>It produces similar plots to NanoPlot but will also give you information about the overall Nanopore sequencing run. In order to generate these, PycoQC uses a <code>sequencing summary</code> file generated by the Nanopore sequencer (e.g.&nbsp;MiniION or PromethION).</p>
<p>We are using NanoPlot because the <code>sequencing summary</code> that PycoQC needs is not avaiable for this dataset. You can see example output files from PycoQC here: <a href="https://a-slide.github.io/pycoQC/pycoQC/results/Guppy-2.1.3_basecall-1D_DNA_barcode.html">Guppy-2.1.3_basecall-1D_DNA_barcode.html</a>. {: .callout}</p>
</blockquote>
<p>We first need to navigate to the <code>qc</code> directory we made earlier <code>cs_course/analysis/qc</code>. ~~~ cd ~/cs_course/analysis/qc/ ~~~ {: .bash}</p>
<p>We are now going to run <code>NanoPlot</code> with the raw Nanopore sequencing file. First we can look at the help documenation for NanoPlot to see what options are available. ~~~ NanoPlot –help ~~~ {: .bash}</p>
<blockquote class="blockquote">
<h2 id="nanoplot-help-documentation" class="anchored">NanoPlot Help Documentation</h2>
<pre><code>usage: NanoPlot [-h] [-v] [-t THREADS] [--verbose] [--store] [--raw] [--huge]m --downsample 10000
                [-o OUTDIR] [-p PREFIX] [--tsv_stats] [--maxlength N]
                [--minlength N] [--drop_outliers] [--downsample N]
                [--loglength] [--percentqual] [--alength] [--minqual N]
                [--runtime_until N] [--readtype {1D,2D,1D2}] [--barcoded]
                [--no_supplementary] [-c COLOR] [-cm COLORMAP]
                [-f {eps,jpeg,jpg,pdf,pgf,png,ps,raw,rgba,svg,svgz,tif,tiff}]
                [--plots [{kde,hex,dot,pauvre} [{kde,hex,dot,pauvre} ...]]]
                [--listcolors] [--listcolormaps] [--no-N50] [--N50]
                [--title TITLE] [--font_scale FONT_SCALE] [--dpi DPI]
                [--hide_stats]
                (--fastq file [file ...] | --fasta file [file ...] | --fastq_rich file [file ...] | --fastq_minimal file [file ...] | --summary file [file ...] | --bam file [file ...] | --ubam file [file ...] | --cram file [file ...] | --pickle pickle | --feather file [file ...])

CREATES VARIOUS PLOTS FOR LONG READ SEQUENCING DATA.

General options:
  -h, --help            show the help and exit
  -v, --version         Print version and exit.
  -t, --threads THREADS
                        Set the allowed number of threads to be used by the script
  --verbose             Write log messages also to terminal.
  --store               Store the extracted data in a pickle file for future plotting.
  --raw                 Store the extracted data in tab separated file.
  --huge                Input data is one very large file.
  -o, --outdir OUTDIR   Specify directory in which output has to be created.
  -p, --prefix PREFIX   Specify an optional prefix to be used for the output files.
  --tsv_stats           Output the stats file as a properly formatted TSV.

Options for filtering or transforming input prior to plotting:
  --maxlength N         Hide reads longer than length specified.
  --minlength N         Hide reads shorter than length specified.
  --drop_outliers       Drop outlier reads with extreme long length.
  --downsample N        Reduce dataset to N reads by random sampling.
  --loglength           Additionally show logarithmic scaling of lengths in plots.
  --percentqual         Use qualities as theoretical percent identities.
  --alength             Use aligned read lengths rather than sequenced length (bam mode)
  --minqual N           Drop reads with an average quality lower than specified.
  --runtime_until N     Only take the N first hours of a run
  --readtype {1D,2D,1D2}
                        Which read type to extract information about from summary. Options are 1D, 2D,
                        1D2
  --barcoded            Use if you want to split the summary file by barcode
  --no_supplementary    Use if you want to remove supplementary alignments

Options for customizing the plots created:
  -c, --color COLOR     Specify a valid matplotlib color for the plots
  -cm, --colormap COLORMAP
                        Specify a valid matplotlib colormap for the heatmap
  -f, --format {eps,jpeg,jpg,pdf,pgf,png,ps,raw,rgba,svg,svgz,tif,tiff}
                        Specify the output format of the plots.
  --plots [{kde,hex,dot,pauvre} [{kde,hex,dot,pauvre} ...]]
                        Specify which bivariate plots have to be made.
  --listcolors          List the colors which are available for plotting and exit.
  --listcolormaps       List the colors which are available for plotting and exit.
  --no-N50              Hide the N50 mark in the read length histogram
  --N50                 Show the N50 mark in the read length histogram
  --title TITLE         Add a title to all plots, requires quoting if using spaces
  --font_scale FONT_SCALE
                        Scale the font of the plots by a factor
  --dpi DPI             Set the dpi for saving images
  --hide_stats          Not adding Pearson R stats in some bivariate plots

Input data sources, one of these is required.:
  --fastq file [file ...]
                        Data is in one or more default fastq file(s).
  --fasta file [file ...]
                        Data is in one or more fasta file(s).
  --fastq_rich file [file ...]
                        Data is in one or more fastq file(s) generated by albacore, MinKNOW or guppy
                        with additional information concerning channel and time.
  --fastq_minimal file [file ...]
                        Data is in one or more fastq file(s) generated by albacore, MinKNOW or guppy
                        with additional information concerning channel and time. Is extracted swiftly
                        without elaborate checks.
  --summary file [file ...]
                        Data is in one or more summary file(s) generated by albacore or guppy.
  --bam file [file ...]
                        Data is in one or more sorted bam file(s).
  --ubam file [file ...]
                        Data is in one or more unmapped bam file(s).
  --cram file [file ...]
                        Data is in one or more sorted cram file(s).
  --pickle pickle       Data is a pickle file stored earlier.
  --feather file [file ...]
                        Data is in one or more feather file(s).

EXAMPLES:
    NanoPlot --summary sequencing_summary.txt --loglength -o summary-plots-log-transformed
    NanoPlot -t 2 --fastq reads1.fastq.gz reads2.fastq.gz --maxlength 40000 --plots hex dot
    NanoPlot --color yellow --bam alignment1.bam alignment2.bam alignment3.bam --downsample 10000</code></pre>
<p>{: .output} {: .solution}</p>
</blockquote>
<p>We will use four flags when we run the NanoPlot command:</p>
<ul>
<li><p><code>--fastq</code> to specify the filetype and file to analyse. The raw Nanopore data is in the location <code>/cs_course/p/data/nano_fastq/ERR5000342_sub12.fastq</code> and we will use this full absolute path in the NanoPlot command.</p></li>
<li><p><code>--outdir</code> to specify the where the output files should be written. We are going to specify <code>nano_qc</code> so that NanoPlot will create a new directory in our current directory (<code>qc</code>) and write its output files to it. <strong>Note</strong>: with NanoPlot you <strong>don’t need to create this directory</strong> before running the command.</p></li>
<li><p><code>--threads</code> specifies how many threads to run the program on (more threads = more compute power = faster). We will specify 4 to indicate that four threads should be used.</p></li>
<li><p><code>--loglength</code> specifies that we want plots with a log scale.</p></li>
</ul>
<pre><code>NanoPlot --fastq ~/cs_course/data/nano_fastq/ERR5000342_sub12.fastq --outdir nano_qc --threads 4 --loglength</code></pre>
<p>{: .bash}</p>
<p>Now we have the command set up we can press enter and wait for NanoPlot to finish.</p>
<p>This will take a couple of minutes. You will know it is finished once your terminal <strong>prompt</strong> has returned (i.e.&nbsp;you can type in the terminal again).</p>
<p>Once NanoPlot has finished we can have a look at the output. First we need to navigate into the <code>nano_qc</code> directory NanoPlot created, then list the files. ~~~ cd nano_qc ls ~~~ {: .bash} ~~~ LengthvsQualityScatterPlot_dot.html LengthvsQualityScatterPlot_loglength_kde.png Non_weightedLogTransformed_HistogramReadlength.png LengthvsQualityScatterPlot_dot.png NanoPlot_202303307_1630.log WeightedHistogramReadlength.html LengthvsQualityScatterPlot_kde.html NanoPlot-report.html WeightedHistogramReadlength.png LengthvsQualityScatterPlot_kde.png NanoStats.txt WeightedLogTransformed_HistogramReadlength.html LengthvsQualityScatterPlot_loglength_dot.html Non_weightedHistogramReadlength.html WeightedLogTransformed_HistogramReadlength.png LengthvsQualityScatterPlot_loglength_dot.png Non_weightedHistogramReadlength.png Yield_By_Length.html LengthvsQualityScatterPlot_loglength_kde.html Non_weightedLogTransformed_HistogramReadlength.html Yield_By_Length.png ~~~ {: .output}</p>
<p>We can see that NanoPlot has generated a lot of different files.</p>
<p>Like before, we can’t view most of these files in our terminal as we can’t open images or HTML files. Instead we’ll download the core information to our own computer. Luckily, the <code>NanoPlot-report.html</code> file contains all of the plots and information held in the other files so we only need to download that one onto our local computer using <code>scp</code>.</p>
<p>Use a terminal that is <strong><em>not</em></strong> logged into the cloud instance and ensure you are in your <code>cloudspan</code> directory. You may have one from earlier. If you do not, unveil the instructions below to start one.</p>
<blockquote class="blockquote">
<h2 id="starting-a-new-terminal-1" class="anchored">Starting a new terminal</h2>
<ol type="1">
<li><p>Open your file manager and navigate to the <code>cloudspan</code> folder which should contain the login key file</p></li>
<li><p>Open your machine’s command line interface: Windows users: Right click anywhere inside the blank space of the file manager, then select <strong>Git Bash Here</strong>. Mac users: Open <strong>Terminal</strong> and type <code>cd</code> followed by the absolute path that leads to your <code>cloudspan</code> folder. Press enter.<br>
</p></li>
<li><p>Check that you are in the right folder using <code>pwd</code></p></li>
</ol>
<p>{: .solution}</p>
</blockquote>
<p>Use <code>scp</code> to copy the file - the command will look something like: ~~~ scp -i login-key-instanceNNN.pem csuser@instanceNNN.cloud-span.aws.york.ac.uk:~/cs_course/analysis/qc/nano_qc/NanoPlot-report.html . ~~~ {: .bash} Remember to replace NNN with the instance number specific to you. As the file is downloading you will see an output like: ~~~ scp -i login-key-instanceNNN.pem csuser@instanceNNN.cloud-span.aws.york.ac.uk:~/cs_course/analysis/qc/nano_qc/NanoPlot-report.html . NanoPlot-report.html 100% 3281KB 2.3MB/s 00:01 ~~~ {: .output}</p>
<p>Once the file has downloaded, use the File Explorer (Windows) or Finder (Mac) to find the file and open it - it should open up in your browser.</p>
<blockquote class="blockquote">
<h2 id="help-1" class="anchored">Help!</h2>
<p>If you had trouble downloading and viewing the file you can view it here: <a href="{{ page.root }}/files/ERR5000342_sub12_nanoplot.html">NanoPlot-report.html</a> {: .bash} {: .callout}</p>
</blockquote>
<p>In the report we can view summary statistics followed by plots showing the distribution of read lengths and the read length vs average read quality.</p>
<p>Looking at the summary statistics table answer the following questions:</p>
<blockquote class="blockquote">
<h2 id="exercise-1" class="anchored">Exercise 1:</h2>
<ol type="1">
<li>How many sequences are in this file?</li>
<li>How many bases are there in this entire file?</li>
<li>What is the length of the longest read in the file and its associated mean quality score?</li>
</ol>
<blockquote class="blockquote">
<h2 id="solution" class="anchored">Solution</h2>
<ol type="1">
<li>There are 316,251 sequences (also known as reads) in this file</li>
<li>There are 1,324,863,094 bases (bp) in total in this FASTQ file</li>
<li>The longest read in this file is 49893 bp and it has a mean quality score of 9.3 {: .solution} {: .challenge}</li>
</ol>
</blockquote>
</blockquote>
<blockquote class="blockquote">
<h2 id="quality-encodings-vary" class="anchored">Quality Encodings Vary</h2>
<p>Note that not all sequencing machines use the same encoding for quality. So <code>#</code> might not always mean 3, a poor quality score.</p>
<p>This means it’s essential that you know which sequencing platform was used to generate your data, so that you can tell your quality control program which encoding to use. If you choose the wrong encoding, you run the risk of throwing away good reads or (even worse) not throwing away bad reads! Nanopore quality encodings are no exception. You can read more about the differences with Nanopore sequencing here: <a href="https://labs.epi2me.io/quality-scores/">EPI2ME - Quality Scores</a>. {: .callout}</p>
</blockquote>
<blockquote class="blockquote">
<h2 id="n50" class="anchored">N50</h2>
<p>The N50 length is a useful statistic when looking at sequences of varying length as it indicates that 50% of the total sequence is in reads (i.e.&nbsp;chunks) that are that size or larger.</p>
<p>For this FASTQ file 50% of the total bases are in reads that have a length of 5,974 bp or longer.</p>
<p>See the webpage <a href="https://www.molecularecologist.com/2017/03/29/whats-n50/">What’s N50?</a> for a good explanation. We will be coming back to this statistic in more detail when we get to the assembly step. {: .callout}</p>
</blockquote>
<p>We can also look at some of the plots produced by NanoPlot.</p>
<p>One useful plot is the plot titled “Read lengths vs Average read quality plot using dots after log transformation of read lengths”. <img align="centre" width="816" src="{{ page.root }}/fig/LengthvsQualityScatterPlot_loglength_dot.png" alt="NanoPlot KDE plot with the title Read lengths vs Average read quality plot using dots after log transformation of read lengths"></p>
<p>This plot shows the average quality of the sequence against the read lengths. We can see that the majority of the sequences have a quality score at least 7. We don’t necessarily need to trim these reads, as this is a good score, but we will do it anyway to show you how.</p>
<p><br clear="left"></p>
</section>
<section id="filtering-nanopore-sequences-by-quality-score" class="level2">
<h2 class="anchored" data-anchor-id="filtering-nanopore-sequences-by-quality-score">Filtering Nanopore sequences by quality score</h2>
<p>We can use the program <a href="https://bioinf.shenwei.me/seqkit/">Seqkit</a> (which contains many tools for FASTQ/A file manipulation) to filter our reads. We will be using the command <code>seqkit seq</code> to create a new file containing only the sequences with an average quality above a certain value.</p>
<p>After returning to our <code>nano_fastq</code> directory, we can view the <code>seqkit seq</code> help documentation with the following command: ~~~ cd ~/cs_course/data/nano_fastq seqkit seq -h ~~~ {: .bash}</p>
<blockquote class="blockquote">
<h2 id="seqkit-seq-help-documentation" class="anchored">Seqkit seq help documentation</h2>
<pre><code>transform sequences (extract ID, filter by length, remove gaps...)

Usage:
  seqkit seq [flags]

Flags:
  -k, --color                     colorize sequences - to be piped into "less -R"
  -p, --complement                complement sequence, flag '-v' is recommended to switch on
      --dna2rna                   DNA to RNA
  -G, --gap-letters string        gap letters (default "- \t.")
  -h, --help                      help for seq
  -l, --lower-case                print sequences in lower case
  -M, --max-len int               only print sequences shorter than the maximum length (-1 for no limit) (default -1)
  -R, --max-qual float            only print sequences with average quality less than this limit (-1 for no limit) (default -1)
  -m, --min-len int               only print sequences longer than the minimum length (-1 for no limit) (default -1)
  -Q, --min-qual float            only print sequences with average quality qreater or equal than this limit (-1 for no limit) (default -1)
  -n, --name                      only print names
  -i, --only-id                   print ID instead of full head
  -q, --qual                      only print qualities
  -b, --qual-ascii-base int       ASCII BASE, 33 for Phred+33 (default 33)
  -g, --remove-gaps               remove gaps
  -r, --reverse                   reverse sequence
      --rna2dna                   RNA to DNA
  -s, --seq                       only print sequences
  -u, --upper-case                print sequences in upper case
  -v, --validate-seq              validate bases according to the alphabet
  -V, --validate-seq-length int   length of sequence to validate (0 for whole seq) (default 10000)

Global Flags:
      --alphabet-guess-seq-length int   length of sequence prefix of the first FASTA record based on which seqkit guesses the sequence type (0 for whole seq) (default 10000)
      --id-ncbi                         FASTA head is NCBI-style, e.g. &gt;gi|110645304|ref|NC_002516.2| Pseud...
      --id-regexp string                regular expression for parsing ID (default "^(\\S+)\\s?")
      --infile-list string              file of input files list (one file per line), if given, they are appended to files from cli arguments
  -w, --line-width int                  line width when outputting FASTA format (0 for no wrap) (default 60)
  -o, --out-file string                 out file ("-" for stdout, suffix .gz for gzipped out) (default "-")
      --quiet                           be quiet and do not show extra information
  -t, --seq-type string                 sequence type (dna|rna|protein|unlimit|auto) (for auto, it automatically detect by the first sequence) (default "auto")
  -j, --threads int                     number of CPUs. can also set with environment variable SEQKIT_THREADS) (default 4)</code></pre>
<p>{: .output} {: .solution}</p>
</blockquote>
<p>From this we can see that the flag <code>-Q</code> will “only print sequences with average quality qreater or equal than this limit (-1 for no limit) (default -1)”.</p>
<p>From the plot above we identified that most of the reads had a quality score of at least 7. To make sure some filtering happens, we’ll use a minimum limit of 8.</p>
<pre><code>seqkit seq -Q 8 ERR5000342_sub12.fastq &gt; ERR5000342_sub12_filtered.fastq</code></pre>
<p>{: .bash}</p>
<p>In the command above we use redirection (<code>&gt;</code>) to generate a new file <code>data/nano_fastq/ERR5000342_sub12_filtered.fastq</code> containing only the reads with an average quality of 8 or above.</p>
<p>We can now re-run NanoPlot on the filtered file to see how it has changed.</p>
<pre><code>cd ~/cs_course/analysis/qc/

NanoPlot --fastq ~/cs_course/data/nano_fastq/ERR5000342_sub12_filtered.fastq --outdir nano_qc_filt --threads 4 --loglength</code></pre>
<p>{: .bash}</p>
<p>Once again, wait for the command to finish and then <code>scp</code> the report to your local computer. First, though, make sure you rename the file so you know which is the filtered report and which isn’t.</p>
<pre><code>cd nano_qc_filt
mv NanoPlot-report.html NanoPlot-report-filtered.html</code></pre>
<p>{: .bash}</p>
<blockquote class="blockquote">
<h2 id="help-2" class="anchored">Help!</h2>
<p>If you had trouble downloading the file you can view it here: <a href="{{ page.root }}/files/ERR5000342_sub12_filt_nanoplot.html">NanoPlot-filtered-report.html</a> {: .callout}</p>
</blockquote>
<p><strong>Compare the NanoPlot statistics of the Nanopore raw reads <a href="{{ page.root }}/files/ERR5000342_sub12_nanoplot.html">before filtering</a> and <a href="{{ page.root }}/files/ERR5000342_sub12_filt_nanoplot.html">after filtering</a> and answer the questions below.</strong></p>
<blockquote class="blockquote">
<h2 id="exercise-2" class="anchored">Exercise 2:</h2>
<ol type="1">
<li>How many reads have been removed by filtering?</li>
<li>How many bases have been removed by filtering?</li>
<li>What is the length of the new longest read and its associated average quality score?</li>
</ol>
<blockquote class="blockquote">
<h2 id="solution-1" class="anchored">Solution</h2>
<ol type="1">
<li>Initially there were 316,251 reads; in the filtered file there are 311,172 reads; so 5079 reads have been removed by the quality filtering</li>
<li>Initially there were 1,324,863,094 bases and after filtering there are 1,303,931,978 base which means filtering has removed 20,931,116 bases</li>
<li>The longest read in the filtered file is the same as before: 49893bp and it has a mean quality score of 9.3. {: .solution} {: .challenge}</li>
</ol>
</blockquote>
</blockquote>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Cloud-SPAN\.github\.io\/nercMtGn-bashAutomation\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../docs/lesson03-qc-assembly/00-introduction-meta.html" class="pagination-link" aria-label="Introduction to Metagenomics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction to Metagenomics</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../docs/lesson03-qc-assembly/02-assembly.html" class="pagination-link" aria-label="Metagenome Assembly">
        <span class="nav-page-text">Metagenome Assembly</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2021–24 by <a href="https://cloud-span.york.ac.uk/">Cloud-SPAN</a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../about.qmd">
<p>About</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../docs/faq/index.qmd">
<p>FAQ</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../license.qmd">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../trademark.qmd">
<p>Trademark</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Cloud-SPAN/nercMtGn-bashAutomation/edit/main/docs/lesson03-qc-assembly/01-QC-quality-raw-reads.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Cloud-SPAN/nercMtGn-bashAutomation/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/quarto_pub">
      <i class="bi bi-twitter" role="img" aria-label="Quarto Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/quarto-dev/quarto-cli">
      <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://quarto.org/docs/blog/index.xml">
      <i class="bi bi-rss" role="img" aria-label="Quarto Blog RSS">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>